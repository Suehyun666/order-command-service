# Application
quarkus.application.name=order-command-service
quarkus.application.version=1.0.0

# gRPC Server
quarkus.http.host=0.0.0.0
quarkus.http.port=9054
quarkus.grpc.server.host=0.0.0.0
quarkus.grpc.server.port=50054
quarkus.grpc.server.use-separate-server=true

# Health Check
quarkus.grpc.server.grpc-health.enabled=true
quarkus.grpc.server.health.enabled=true

# ----------------------------------------------------
# gRPC Clients - High Performance Configuration
quarkus.grpc.clients.account-command-service.host=${ACCOUNT_SERVICE_HOST:localhost}
quarkus.grpc.clients.account-command-service.port=${ACCOUNT_SERVICE_PORT:50053}
quarkus.grpc.clients.account-command-service.plain-text=true
quarkus.grpc.clients.account-command-service.keep-alive-time=30s
quarkus.grpc.clients.account-command-service.keep-alive-timeout=5s
quarkus.grpc.clients.account-command-service.idle-timeout=60s
quarkus.grpc.clients.account-command-service.max-inbound-message-size=4194304
quarkus.grpc.clients.account-command-service.use-quarkus-grpc-client=true

# Auth Service Client - Optimized for 10000 TPS
quarkus.grpc.clients.auth-command-service.host=${AUTH_SERVICE_HOST:localhost}
quarkus.grpc.clients.auth-command-service.port=${AUTH_SERVICE_PORT:50052}
quarkus.grpc.clients.auth-command-service.plain-text=true
quarkus.grpc.clients.auth-command-service.keep-alive-time=30s
quarkus.grpc.clients.auth-command-service.keep-alive-timeout=5s
quarkus.grpc.clients.auth-command-service.idle-timeout=60s
quarkus.grpc.clients.auth-command-service.max-inbound-message-size=4194304
quarkus.grpc.clients.auth-command-service.use-quarkus-grpc-client=true
quarkus.grpc.clients.auth-command-service.negotiation-type=PLAINTEXT
# ----------------------------------------------------

# Database Configuration
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USER:hts}
quarkus.datasource.password=${DB_PASSWORD:hts}

# Reactive PostgreSQL Configuration (Primary for high throughput)
quarkus.datasource.reactive.url=${DB_REACTIVE_URL:postgresql://localhost:5433/hts_order}
quarkus.datasource.reactive.max-size=32
quarkus.datasource.reactive.idle-timeout=PT2M
quarkus.datasource.reactive.max-lifetime=PT15M
quarkus.datasource.reactive.cache-prepared-statements=true

# JDBC Configuration (For Flyway migrations only)
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5433/hts_order
quarkus.datasource.jdbc.min-size=2
quarkus.datasource.jdbc.max-size=4

# JOOQ 
quarkus.jooq.dialect=POSTGRES

# Flyway
quarkus.flyway.migrate-at-start=true
quarkus.flyway.repair-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.locations=db/migration

# vert.x Configuration
quarkus.vertx.event-loops-pool-size=32
quarkus.vertx.internal-blocking-pool-size=32

# Logging Configuration
quarkus.log.level=INFO
quarkus.log.category."io.grpc".level=INFO
quarkus.log.category."io.smallrye".level=INFO

# Metrics Configuration
quarkus.micrometer.enabled=true
quarkus.micrometer.registry-enabled-default=true
quarkus.micrometer.binder-enabled-default=true
quarkus.micrometer.binder.jvm=true
quarkus.micrometer.binder.system=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics

# Kafka
kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Kafka - Outgoing - Order Events
mp.messaging.outgoing.order-events.connector=smallrye-kafka
mp.messaging.outgoing.order-events.topic=order.filled.events
mp.messaging.outgoing.order-events.delivery.timeout.ms=30000
mp.messaging.outgoing.order-events.request.timeout.ms=15000
mp.messaging.outgoing.order-events.acks=1
mp.messaging.outgoing.order-events.batch.size=32768
mp.messaging.outgoing.order-events.linger.ms=10
mp.messaging.outgoing.order-events.value.serializer=org.apache.kafka.common.serialization.StringSerializer
mp.messaging.connector.smallrye-kafka.allow.auto.create.topics=true
mp.messaging.connector.smallrye-kafka.request.timeout.ms=5000
mp.messaging.connector.smallrye-kafka.session.timeout.ms=10000
mp.messaging.connector.smallrye-kafka.heartbeat.interval.ms=3000


# Fault Tolerance
mp.fault.tolerance.bulkhead.value=512
mp.fault.tolerance.bulkhead.waitingTaskQueue=512
mp.fault.tolerance.timeout.value=2000
mp.fault.tolerance.retry.maxRetries=1
mp.fault.tolerance.retry.delay=10
mp.fault.tolerance.circuitbreaker.failureRatio=0.2
mp.fault.tolerance.circuitbreaker.requestVolumeThreshold=50
mp.fault.tolerance.circuitbreaker.delay=30000


# Container Image Configuration
quarkus.container-image.group=suehunpark
quarkus.container-image.name=order-command-service
quarkus.container-image.registry=docker.io